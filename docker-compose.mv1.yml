services:
  # Broker
  broker:
    build:
      context: .
      dockerfile: broker/dockerfile
    command: ["./broker/broker", "--broker=B1"]
    ports:
      - "50051:50051"
    volumes:
      - ./flight_updates.csv:/app/flight_updates.csv
      - ./output:/app/output
    stdin_open: true
    tty: true
    environment:
      - BROKER_HOST=10.35.168.23
      - DATANODE1_HOST=10.35.168.25 # IP de MV3
      - DATANODE2_HOST=10.35.168.26  # IP de MV4  
      - DATANODE3_HOST=10.35.168.23
      - CONSENSO1_HOST=10.35.168.24  # IP de MV2
      - CONSENSO2_HOST=10.35.168.25  # IP de MV3
      - CONSENSO3_HOST=10.35.168.26  # IP de MV4

  # Datanode 3
  datanode3:
    build:
      context: .
      dockerfile: datanodes/dockerfile
    command: ["./datanodes/datanode", "--nodo=DN3"]
    ports:
      - "50060:50060"
    depends_on:
      - broker
    environment:
      - BROKER_HOST=10.35.168.23
      - DATANODE_HOST=10.35.168.23
      - DATANODE1_HOST=10.35.168.25  # IP de MV3
      - DATANODE2_HOST=10.35.168.26  # IP de MV4

  # Cliente RYW 1
  cliente-ryw1:
    build:
      context: .
      dockerfile: clientesRYW/dockerfile
    command: ["./clientesRYW/cliente-ryw", "--cliente=RYW1"]
    ports:
      - "50053:50053"
    depends_on:
      - broker
    environment:
      - COORDINADOR_HOST=10.35.168.26  # IP de MV4
      - BROKER_HOST=10.35.168.23
      - CLIENTE_RYW_HOST=10.35.168.23

  # Cliente MR 1
  cliente-mr1:
    build:
      context: .
      dockerfile: clientesMR/dockerfile
    command: ["./clientesMR/cliente-mr", "--cliente=MR1"]
    ports:
      - "50056:50056"
    depends_on:
      - broker
    environment:
      - BROKER_HOST=10.35.168.23
      - CLIENTE_MR_HOST=10.35.168.23
